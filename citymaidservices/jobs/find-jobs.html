<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Find Jobs - City Maid Services</title>
    <script src="https://cdn.tailwindcss.com?plugins=forms,typography,aspect-ratio"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        poppins: ['Poppins', 'sans-serif'],
                    },
                    colors: {
                        brand: {
                            primary: '#4F46E5',
                            secondary: '#4338CA',
                            light: '#EEF2FF',
                        }
                    }
                }
            }
        }
    </script>
</head>
<body class="font-poppins bg-gray-50" data-current-page="find-jobs">
    <!-- Navigation Bar -->
    <nav class="bg-white shadow-lg sticky top-0 z-50">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between h-20">
                <div class="flex items-center">
                    <a href="../index.html" class="text-3xl font-bold text-brand-primary tracking-tight">City<span class="text-brand-secondary"> Maid</span></a>
                </div>
                <!-- Mobile menu button -->
                <div class="flex items-center md:hidden">
                    <button id="mobileMenuBtn" class="text-gray-700 hover:text-brand-primary focus:outline-none" aria-label="Open menu">
                        <i class="fas fa-bars text-2xl"></i>
                    </button>
                </div>
                <!-- Desktop menu -->
                <div class="hidden md:flex items-center space-x-6">
                    <a href="../index.html" class="nav-link" data-page="home">Home</a>
                    <a href="find-maids.html" class="nav-link" data-page="find-maids" id="find-maids-link">Find Maids</a>
                    <a href="find-jobs.html" class="nav-link active" data-page="find-jobs">Find Jobs</a>
                    <a href="../maid/profile.html" class="nav-link maid-only" data-page="create-profile">Create Profile</a>
                    <a href="../maid/dashboard.html" class="nav-link maid-only" data-page="dashboard">Dashboard</a>
                    <a href="../maid/edit-profile.html" class="nav-link maid-only" data-page="edit-profile">Edit Profile</a>
                    <a href="../maid/post-profile.html" class="bg-green-600 text-white px-6 py-2 rounded-lg hover:bg-green-700 font-semibold transition-colors ml-2">Create Profile</a>
                    
                    <!-- Auth links: shown when not logged in -->
                    <div id="auth-links">
                        <a href="../auth/login.html" class="bg-brand-primary text-white px-6 py-2 rounded-lg hover:bg-brand-secondary font-semibold transition-colors">
                            Sign In
                        </a>
                    </div>
                    
                    <!-- User menu: shown when logged in -->
                    <div id="user-menu" class="hidden relative">
                        <button id="userMenuBtn" class="flex items-center space-x-2 text-gray-700 hover:text-brand-primary">
                            <i class="fas fa-user-circle text-2xl"></i>
                            <span class="font-medium" id="user-role-display">My Account</span>
                        </button>
                        <div class="hidden absolute right-0 mt-2 w-48 bg-white rounded-lg shadow-lg py-2 z-50" id="user-dropdown">
                            <a href="../employer/dashboard.html" class="block px-4 py-2 hover:bg-gray-100 employer-only">Dashboard</a>
                            <a href="../employer/profile.html" class="block px-4 py-2 hover:bg-gray-100 employer-only">Profile</a>
                            <a href="../maid/dashboard.html" class="block px-4 py-2 hover:bg-gray-100 maid-only">Dashboard</a>
                            <a href="../maid/profile.html" class="block px-4 py-2 hover:bg-gray-100 maid-only">Profile</a>
                            <a href="#" id="signOutBtn" class="block px-4 py-2 hover:bg-gray-100">Sign Out</a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <!-- Mobile menu panel -->
        <div id="mobileMenu" class="hidden md:hidden fixed inset-0 bg-black bg-opacity-50 z-50">
            <div class="fixed inset-y-0 right-0 max-w-xs w-full bg-white shadow-xl">
                <div class="flex items-center justify-between p-4 border-b">
                    <div class="flex items-center space-x-4">
                        <button onclick="window.history.back()" class="text-gray-500 hover:text-gray-700" aria-label="Go back">
                            <i class="fas fa-arrow-left text-xl"></i>
                        </button>
                        <a href="../index.html" class="text-gray-500 hover:text-gray-700" aria-label="Go to homepage">
                            <i class="fas fa-home text-xl"></i>
                        </a>
                    </div>
                    <h2 class="text-xl font-semibold text-gray-900">Menu</h2>
                    <button id="closeMobileMenu" class="text-gray-500 hover:text-gray-700" aria-label="Close menu">
                        <i class="fas fa-times text-2xl"></i>
                    </button>
                </div>
                <div class="p-4 space-y-4">
                    <a href="../index.html" class="block nav-link" data-page="home">Home</a>
                    <a href="find-maids.html" class="block nav-link" data-page="find-maids" id="mobile-find-maids-link">Find Maids</a>
                    <a href="find-jobs.html" class="block nav-link active" data-page="find-jobs">Find Jobs</a>
                    <a href="../maid/profile.html" class="block nav-link maid-only" data-page="create-profile">Create Profile</a>
                    <a href="../maid/dashboard.html" class="block nav-link maid-only" data-page="dashboard">Dashboard</a>
                    <a href="../maid/edit-profile.html" class="block nav-link maid-only" data-page="edit-profile">Edit Profile</a>
                    <a href="../maid/post-profile.html" class="block text-white bg-green-600 py-2 px-4 rounded-lg font-medium hover:bg-green-700 mt-2">Create Profile</a>
                    
                    <!-- Mobile auth links -->
                    <div class="pt-4 border-t border-gray-200" id="mobile-auth-links">
                        <a href="../auth/login.html" class="block text-gray-700 hover:text-brand-primary font-medium transition-colors mt-4">Sign In</a>
                    </div>
                    
                    <!-- Mobile user menu -->
                    <div class="pt-4 border-t border-gray-200 hidden" id="mobile-user-menu">
                        <a href="../employer/dashboard.html" class="block text-gray-700 hover:text-brand-primary font-medium transition-colors mt-4 employer-only">Dashboard</a>
                        <a href="../employer/profile.html" class="block text-gray-700 hover:text-brand-primary font-medium transition-colors mt-4 employer-only">Profile</a>
                        <a href="../maid/dashboard.html" class="block text-gray-700 hover:text-brand-primary font-medium transition-colors mt-4 maid-only">Dashboard</a>
                        <a href="../maid/profile.html" class="block text-gray-700 hover:text-brand-primary font-medium transition-colors mt-4 maid-only">Profile</a>
                        <a href="#" id="mobile-sign-out" class="block text-gray-700 hover:text-brand-primary font-medium transition-colors mt-4">Sign Out</a>
                    </div>
                </div>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-12">
        <!-- Page Header -->
        <div class="text-center mb-12">
            <h1 class="text-4xl font-bold text-gray-900 mb-4">Available Cleaning Jobs</h1>
            <p class="text-xl text-gray-600 max-w-3xl mx-auto">Browse and apply for cleaning jobs posted by employers in your area.</p>
        </div>

        <!-- Filter Section -->
        <div class="bg-white rounded-lg shadow-md p-6 mb-8">
            <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
                <div>
                    <label for="location" class="block text-sm font-medium text-gray-700 mb-1">Location</label>
                    <select id="location" class="w-full rounded-md border-gray-300 shadow-sm focus:border-brand-primary focus:ring focus:ring-brand-primary focus:ring-opacity-50">
                        <option value="">All Locations</option>
                        <option value="kathmandu">Kathmandu</option>
                        <option value="lalitpur">Lalitpur</option>
                        <option value="bhaktapur">Bhaktapur</option>
                        <option value="pokhara">Pokhara</option>
                    </select>
                </div>
                <div>
                    <label for="jobType" class="block text-sm font-medium text-gray-700 mb-1">Job Type</label>
                    <select id="jobType" class="w-full rounded-md border-gray-300 shadow-sm focus:border-brand-primary focus:ring focus:ring-brand-primary focus:ring-opacity-50">
                        <option value="">All Types</option>
                        <option value="regular">Regular</option>
                        <option value="one-time">One-time</option>
                        <option value="weekly">Weekly</option>
                        <option value="monthly">Monthly</option>
                    </select>
                </div>
                <div>
                    <label for="wage" class="block text-sm font-medium text-gray-700 mb-1">Min. Wage (₹)</label>
                    <input type="number" id="wage" placeholder="Any" class="w-full rounded-md border-gray-300 shadow-sm focus:border-brand-primary focus:ring focus:ring-brand-primary focus:ring-opacity-50">
                </div>
                <div class="flex items-end">
                    <button id="search-btn" class="w-full bg-brand-primary text-white py-2 px-4 rounded-md hover:bg-brand-secondary transition-colors focus:outline-none focus:ring-2 focus:ring-brand-primary focus:ring-opacity-50">
                        <i class="fas fa-search mr-2"></i> Search Jobs
                    </button>
                </div>
            </div>
        </div>

        <!-- Jobs List -->
        <div id="jobsContainer" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
            <!-- Jobs will be loaded here -->
            <div class="animate-pulse bg-white rounded-lg shadow-md overflow-hidden">
                <div class="p-6">
                    <div class="h-6 bg-gray-200 rounded w-3/4 mb-4"></div>
                    <div class="h-4 bg-gray-200 rounded w-1/2 mb-2"></div>
                    <div class="h-4 bg-gray-200 rounded w-full mb-2"></div>
                    <div class="h-4 bg-gray-200 rounded w-5/6 mb-4"></div>
                    <div class="flex justify-between mt-6">
                        <div class="h-8 bg-gray-200 rounded w-1/3"></div>
                        <div class="h-8 bg-gray-200 rounded w-1/3"></div>
                    </div>
                </div>
            </div>
            <div class="animate-pulse bg-white rounded-lg shadow-md overflow-hidden">
                <div class="p-6">
                    <div class="h-6 bg-gray-200 rounded w-3/4 mb-4"></div>
                    <div class="h-4 bg-gray-200 rounded w-1/2 mb-2"></div>
                    <div class="h-4 bg-gray-200 rounded w-full mb-2"></div>
                    <div class="h-4 bg-gray-200 rounded w-5/6 mb-4"></div>
                    <div class="flex justify-between mt-6">
                        <div class="h-8 bg-gray-200 rounded w-1/3"></div>
                        <div class="h-8 bg-gray-200 rounded w-1/3"></div>
                    </div>
                </div>
            </div>
            <div class="animate-pulse bg-white rounded-lg shadow-md overflow-hidden">
                <div class="p-6">
                    <div class="h-6 bg-gray-200 rounded w-3/4 mb-4"></div>
                    <div class="h-4 bg-gray-200 rounded w-1/2 mb-2"></div>
                    <div class="h-4 bg-gray-200 rounded w-full mb-2"></div>
                    <div class="h-4 bg-gray-200 rounded w-5/6 mb-4"></div>
                    <div class="flex justify-between mt-6">
                        <div class="h-8 bg-gray-200 rounded w-1/3"></div>
                        <div class="h-8 bg-gray-200 rounded w-1/3"></div>
                    </div>
                </div>
            </div>
        </div>

        <!-- No results message (hidden by default) -->
        <div id="noResults" class="hidden text-center py-10">
            <i class="fas fa-search text-5xl text-gray-400 mb-4"></i>
            <h3 class="text-xl font-medium text-gray-700 mb-2">No jobs found</h3>
            <p class="text-gray-500">Try adjusting your search filters or check back later for new opportunities.</p>
        </div>

        <!-- Pagination -->
        <div class="flex justify-center mt-10">
            <nav class="flex items-center space-x-2">
                <button id="prev-page" class="px-3 py-1 rounded-md border border-gray-300 text-gray-500 hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed" title="Previous page">
                    <i class="fas fa-chevron-left"></i>
                </button>
                <span id="pagination-info" class="text-sm text-gray-700">Page <span id="current-page">1</span> of <span id="total-pages">1</span></span>
                <button id="next-page" class="px-3 py-1 rounded-md border border-gray-300 text-gray-500 hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed" title="Next page">
                    <i class="fas fa-chevron-right"></i>
                </button>
            </nav>
        </div>
    </main>

    <!-- Footer -->
    <footer class="bg-gray-900 text-white py-12">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="grid grid-cols-1 md:grid-cols-4 gap-8">
                <div>
                    <h3 class="text-xl font-bold mb-4">City Maid Services</h3>
                    <p class="text-gray-400">Connecting trusted domestic helpers with employers in your area.</p>
                </div>
                <div>
                    <h3 class="text-xl font-bold mb-4">Quick Links</h3>
                    <ul class="space-y-2">
                        <li><a href="../index.html" class="text-gray-400 hover:text-white transition-colors">Home</a></li>
                        <li><a href="find-maids.html" class="text-gray-400 hover:text-white transition-colors">Find Maids</a></li>
                    </ul>
                </div>
                <div>
                    <h3 class="text-xl font-bold mb-4">Contact</h3>
                    <ul class="space-y-2">
                        <li class="flex items-center text-gray-400">
                            <i class="fas fa-map-marker-alt mr-2"></i> Kathmandu, Nepal
                        </li>
                        <li class="flex items-center text-gray-400">
                            <i class="fas fa-phone mr-2"></i> +977 1234567
                        </li>
                        <li class="flex items-center text-gray-400">
                            <i class="fas fa-envelope mr-2"></i> info@citymaidservices.com
                        </li>
                    </ul>
                </div>
                <div>
                    <h3 class="text-xl font-bold mb-4">Follow Us</h3>
                    <div class="flex space-x-4">
                        <a href="#" class="text-gray-400 hover:text-white transition-colors">
                            <i class="fab fa-facebook-f text-xl"></i>
                        </a>
                        <a href="#" class="text-gray-400 hover:text-white transition-colors">
                            <i class="fab fa-twitter text-xl"></i>
                        </a>
                        <a href="#" class="text-gray-400 hover:text-white transition-colors">
                            <i class="fab fa-instagram text-xl"></i>
                        </a>
                        <a href="#" class="text-gray-400 hover:text-white transition-colors">
                            <i class="fab fa-linkedin-in text-xl"></i>
                        </a>
                    </div>
                </div>
            </div>
            <div class="border-t border-gray-800 mt-8 pt-8 text-center text-gray-400">
                <p>&copy; <span id="currentYear"></span> City Maid Services. All rights reserved.</p>
            </div>
        </div>
    </footer>

    <script>
        // Initialize Supabase client
        const supabaseUrl = 'https://fdgqqxyyofjnkhswkwcq.supabase.co';
        const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImZkZ3FxeHl5b2Zqbmtoc3drd2NxIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDQwMjQyMTMsImV4cCI6MjA1OTYwMDIxM30.YyJLLu3r2a7Mh7ny0ie-YzzLfPh5PdrJJHnBFBxWqVE';
        const supabaseClient = supabase.createClient(supabaseUrl, supabaseKey);

        // Check user role on page load
        document.addEventListener('DOMContentLoaded', function() {
            checkUserRole();
            initNavigation();
            
            // ... existing DOM ready code ...
        });

        // Function to check if user has a role and it matches this page
        async function checkUserRole() {
            const userRole = localStorage.getItem('userRole');
            
            // Check if user has appropriate role for this page
            if (userRole === 'employer') {
                // Employers should not access the Find Jobs page, redirect them
                window.location.href = 'find-maids.html';
                return;
            }
            
            // Show/hide appropriate menu items based on role
            updateNavigation(userRole);
            
            // Check if the user is logged in
            const { data: { session }, error } = await supabaseClient.auth.getSession();
            
            if (error) {
                console.error('Error checking session:', error);
                return;
            }
            
            if (session) {
                // User is logged in, update UI accordingly
                document.getElementById('auth-links').classList.add('hidden');
                document.getElementById('user-menu').classList.remove('hidden');
                document.getElementById('mobile-auth-links').classList.add('hidden');
                document.getElementById('mobile-user-menu').classList.remove('hidden');
                
                // Set user role display
                const roleDisplayText = userRole === 'employer' ? 'Employer' : 'Maid';
                document.getElementById('user-role-display').textContent = roleDisplayText;
            } else {
                // No active session, ensure login buttons are visible
                document.getElementById('auth-links').classList.remove('hidden');
                document.getElementById('user-menu').classList.add('hidden');
                document.getElementById('mobile-auth-links').classList.remove('hidden');
                document.getElementById('mobile-user-menu').classList.add('hidden');
            }
        }
        
        // Function to update navigation based on role
        function updateNavigation(userRole) {
            // Get all elements that should only be shown to employers
            const employerOnlyElements = document.querySelectorAll('.employer-only');
            // Get all elements that should only be shown to maids
            const maidOnlyElements = document.querySelectorAll('.maid-only');
            
            if (userRole === 'employer') {
                // Show employer-specific elements, hide maid-specific ones
                employerOnlyElements.forEach(el => el.classList.remove('hidden'));
                maidOnlyElements.forEach(el => el.classList.add('hidden'));
            } else if (userRole === 'maid') {
                // Show maid-specific elements, hide employer-specific ones
                maidOnlyElements.forEach(el => el.classList.remove('hidden'));
                employerOnlyElements.forEach(el => el.classList.add('hidden'));
                
                // Hide the Find Maids link as maids don't need it
                document.getElementById('find-maids-link').classList.add('hidden');
                document.getElementById('mobile-find-maids-link').classList.add('hidden');
            }
        }
        
        // Initialize navigation functionality
        function initNavigation() {
            // User menu dropdown
            const userMenuBtn = document.getElementById('userMenuBtn');
            const userDropdown = document.getElementById('user-dropdown');
            
            if (userMenuBtn && userDropdown) {
                userMenuBtn.addEventListener('click', (e) => {
                    e.stopPropagation();
                    userDropdown.classList.toggle('hidden');
                });
                
                // Close dropdown when clicking elsewhere
                document.addEventListener('click', () => {
                    userDropdown.classList.add('hidden');
                });
            }
            
            // Sign out functionality
            const signOutBtns = [
                document.getElementById('signOutBtn'),
                document.getElementById('mobile-sign-out')
            ];
            
            signOutBtns.forEach(btn => {
                if (btn) {
                    btn.addEventListener('click', async (e) => {
                        e.preventDefault();
                        try {
                            await supabaseClient.auth.signOut();
                            window.location.href = '../index.html';
                        } catch (error) {
                            console.error('Error signing out:', error);
                        }
                    });
                }
            });
            
            // Mobile menu functionality
            const mobileMenuBtn = document.getElementById('mobileMenuBtn');
            const closeMobileMenuBtn = document.getElementById('closeMobileMenu');
            const mobileMenu = document.getElementById('mobileMenu');
            
            if (mobileMenuBtn && closeMobileMenuBtn && mobileMenu) {
                mobileMenuBtn.addEventListener('click', () => {
                    mobileMenu.classList.remove('hidden');
                });
                
                closeMobileMenuBtn.addEventListener('click', () => {
                    mobileMenu.classList.add('hidden');
                });
            }
        }

        // Sample job data to use when Supabase tables don't exist
        const sampleJobs = [
            {
                title: "Regular House Cleaning",
                location: "Kathmandu",
                job_type: "Regular",
                hourly_rate: 250,
                description: "Looking for a reliable maid for regular house cleaning in Kathmandu. Duties include sweeping, mopping, dusting, and kitchen cleaning. Must be available 3 days per week.",
                created_at: new Date().toISOString()
            },
            {
                title: "Childcare and Light Cleaning",
                location: "Lalitpur",
                job_type: "Full-time",
                hourly_rate: 300,
                description: "Need a full-time maid for childcare and light cleaning duties. Experience with children required. Must be patient and caring. Live-in option available.",
                created_at: new Date().toISOString()
            },
            {
                title: "Office Cleaning Service",
                location: "Bhaktapur",
                job_type: "Weekly",
                hourly_rate: 220,
                description: "Small office looking for a weekly cleaning service. Duties include cleaning common areas, bathrooms, and meeting rooms. Please have prior experience in office cleaning.",
                created_at: new Date().toISOString()
            },
            {
                title: "Post-Construction Cleaning",
                location: "Kathmandu",
                job_type: "One-time",
                hourly_rate: 400,
                description: "Need a thorough cleaning service after house renovation. Deep cleaning of all rooms, removing construction dust, and cleaning windows. This is a one-time project.",
                created_at: new Date().toISOString()
            },
            {
                title: "Elderly Care and Housekeeping",
                location: "Pokhara",
                job_type: "Live-in",
                hourly_rate: 350,
                description: "Looking for a compassionate caregiver for an elderly person who can also handle light housekeeping. Should be experienced in elderly care. Live-in position with one day off per week.",
                created_at: new Date().toISOString()
            },
            {
                title: "Weekend Deep Cleaning",
                location: "Lalitpur",
                job_type: "Weekly",
                hourly_rate: 280,
                description: "Family seeks weekend deep cleaning service for a 3-bedroom apartment. Duties include thorough cleaning of bathrooms, kitchen, floors, and windows. Must be detail-oriented.",
                created_at: new Date().toISOString()
            }
        ];

        // Global variables
        let currentPage = 1;
        let totalPages = 1;
        const jobsPerPage = 9;
        let allJobs = [];
        let filteredJobs = [];

        // DOM elements
        const jobsContainer = document.getElementById('jobsContainer');
        const noResults = document.getElementById('noResults');
        const searchBtn = document.getElementById('search-btn');
        const prevPageBtn = document.getElementById('prev-page');
        const nextPageBtn = document.getElementById('next-page');
        const currentPageEl = document.getElementById('current-page');
        const totalPagesEl = document.getElementById('total-pages');

        // Set current year in footer
        document.getElementById('currentYear').textContent = new Date().getFullYear();
        
        // Mobile menu functionality
        document.getElementById('mobileMenuBtn').addEventListener('click', function() {
            document.getElementById('mobileMenu').classList.remove('hidden');
        });

        document.getElementById('closeMobileMenu').addEventListener('click', function() {
            document.getElementById('mobileMenu').classList.add('hidden');
        });

        // Highlight active nav link
        document.querySelectorAll('.nav-link').forEach(link => {
            if (link.dataset.page === document.body.dataset.currentPage) {
                link.classList.add('text-brand-primary', 'font-semibold');
            } else {
                link.classList.add('text-gray-700', 'hover:text-brand-primary');
            }
        });

        // Fetch jobs from Supabase, or use sample data if tables don't exist
        async function fetchJobs() {
            try {
                // Look for jobs in job_listings first
                console.log('Fetching from job_listings table...');
                let { data: jobListings, error: jobListingsError } = await supabaseClient
                    .from('job_listings')
                    .select('*');
                
                if (!jobListingsError && jobListings && jobListings.length > 0) {
                    console.log('Using job_listings table with', jobListings.length, 'records');
                    allJobs = jobListings;
                } else {
                    // Try jobs table if job_listings fails
                    console.log('Trying jobs table...');
                    let { data: jobs, error: jobsError } = await supabaseClient
                        .from('jobs')
                        .select('*');
                    
                    if (!jobsError && jobs && jobs.length > 0) {
                        console.log('Using jobs table with', jobs.length, 'records');
                        allJobs = jobs;
                    } else {
                        // Try employer_jobs if jobs fails
                        console.log('Trying employer_jobs table...');
                        let { data: employerJobs, error: employerJobsError } = await supabaseClient
                            .from('employer_jobs')
                            .select('*');
                        
                        if (!employerJobsError && employerJobs && employerJobs.length > 0) {
                            console.log('Using employer_jobs table with', employerJobs.length, 'records');
                            allJobs = employerJobs;
                        } else {
                            // No valid table found, use sample data
                            console.log('No job tables found with data, using sample data');
                            allJobs = sampleJobs;
                        }
                    }
                }
                
                filteredJobs = [...allJobs];
                updatePagination();
                displayJobs();
            } catch (error) {
                console.error('Error fetching jobs:', error);
                // Use sample data as fallback
                console.log('Error caught, using sample data as fallback');
                allJobs = sampleJobs;
                filteredJobs = [...sampleJobs];
                updatePagination();
                displayJobs();
            }
        }

        // Filter jobs based on selected criteria
        function filterJobs() {
            const location = document.getElementById('location').value.toLowerCase();
            const jobType = document.getElementById('jobType').value.toLowerCase();
            const wage = parseInt(document.getElementById('wage').value) || 0;
            
            filteredJobs = allJobs.filter(job => {
                // Check if the properties exist before accessing them
                const jobLocation = job.location || job.work_location || '';
                const type = job.job_type || job.type || '';
                const rate = job.hourly_rate || job.salary || job.rate || 0;
                
                const locationMatch = !location || jobLocation.toLowerCase().includes(location);
                const jobTypeMatch = !jobType || type.toLowerCase().includes(jobType);
                const wageMatch = !wage || rate >= wage;
                
                return locationMatch && jobTypeMatch && wageMatch;
            });
            
            currentPage = 1;
            updatePagination();
            displayJobs();
        }

        // Display jobs with pagination
        function displayJobs() {
            // Calculate start and end index for current page
            const startIndex = (currentPage - 1) * jobsPerPage;
            const endIndex = startIndex + jobsPerPage;
            const jobsToDisplay = filteredJobs.slice(startIndex, endIndex);
            
            if (jobsToDisplay.length === 0) {
                jobsContainer.innerHTML = '';
                noResults.classList.remove('hidden');
            } else {
                noResults.classList.add('hidden');
                
                jobsContainer.innerHTML = jobsToDisplay.map(job => {
                    console.log('Rendering job:', job);
                    return `
                    <div class="bg-white rounded-lg shadow-md overflow-hidden hover:shadow-lg transition-shadow">
                        <div class="p-6">
                            <h3 class="text-xl font-semibold text-gray-900 mb-2">${job.title || job.job_title || 'Untitled Job'}</h3>
                            <div class="flex items-center text-gray-600 mb-3">
                                <i class="fas fa-map-marker-alt mr-2 text-brand-primary"></i>
                                <span>${job.location || job.work_location || 'Location not specified'}</span>
                            </div>
                            <div class="flex items-center text-gray-600 mb-3">
                                <i class="fas fa-clock mr-2 text-brand-primary"></i>
                                <span>${job.job_type || job.type || 'Type not specified'}</span>
                            </div>
                            <div class="flex items-center text-gray-600 mb-4">
                                <i class="fas fa-dollar-sign mr-2 text-brand-primary"></i>
                                <span>₹${job.hourly_rate || job.salary || job.rate || 0}/hour</span>
                            </div>
                            <p class="text-gray-700 mb-4 line-clamp-3">${job.description || job.details || 'No description available'}</p>
                            <div class="flex justify-between items-center mt-4">
                                <span class="inline-flex items-center rounded-full bg-brand-light px-3 py-1 text-sm font-medium text-brand-primary">
                                    <i class="fas fa-calendar-alt mr-1"></i> ${job.created_at ? new Date(job.created_at).toLocaleDateString() : 'Recent'}
                                </span>
                                <a href="view-detail.html?id=${job.id}" class="bg-brand-primary text-white py-2 px-4 rounded-md hover:bg-brand-secondary transition-colors focus:outline-none">
                                    View Detail
                                </a>
                            </div>
                        </div>
                    </div>
                `}).join('');
            }
        }

        // Update pagination controls
        function updatePagination() {
            totalPages = Math.ceil(filteredJobs.length / jobsPerPage);
            
            if (currentPage > totalPages && totalPages > 0) {
                currentPage = totalPages;
            }
            
            currentPageEl.textContent = currentPage;
            totalPagesEl.textContent = totalPages;
            
            prevPageBtn.disabled = currentPage <= 1;
            nextPageBtn.disabled = currentPage >= totalPages;
        }

        // Event listeners
        searchBtn.addEventListener('click', filterJobs);
        
        prevPageBtn.addEventListener('click', () => {
            if (currentPage > 1) {
                currentPage--;
                updatePagination();
                displayJobs();
                window.scrollTo({ top: 0, behavior: 'smooth' });
            }
        });
        
        nextPageBtn.addEventListener('click', () => {
            if (currentPage < totalPages) {
                currentPage++;
                updatePagination();
                displayJobs();
                window.scrollTo({ top: 0, behavior: 'smooth' });
            }
        });

        // Initialize page
        document.addEventListener('DOMContentLoaded', () => {
            fetchJobs();
        });
    </script>
</body>
</html> 